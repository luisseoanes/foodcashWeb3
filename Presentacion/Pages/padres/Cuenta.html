<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Cuenta - Food Cash</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../css/General.css"> 
    <script src="../../js/general.js"></script>

    <style>
        /* --- NUEVOS ESTILOS MEJORADOS --- */

        .account-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 30px;
        }

        /* Tarjeta de perfil con diseño premium */
        .profile-card {
            background: #fff;
            padding: 30px;
            border-radius: 16px; /* Bordes más redondeados */
            border: 1px solid #e9ecef;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.07);
            transition: all 0.3s ease-in-out;
        }
        .profile-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }

        /* Encabezado con avatar mejorado */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }
        .profile-header .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            /* Degradado para el avatar */
            background: linear-gradient(135deg, #5691c8, #007bff);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: 700;
            border: 3px solid white;
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.3);
        }
        .profile-header .user-info h3 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
        }
        .profile-header .user-info p {
            margin: 0;
            color: #6c757d;
            font-size: 16px;
        }

        /* Lista de detalles con iconos */
        .details-list {
            list-style: none;
            padding: 0;
        }
        .details-list li {
            display: flex;
            align-items: center;
            padding: 15px 5px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 15px;
        }
        .details-list li:last-child { border-bottom: none; }
        
        .details-list .label {
            font-weight: 600;
            color: #343a40;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-basis: 50%;
        }
        .details-list .label i {
            color: #007bff;
            width: 20px;
            text-align: center;
        }
        .details-list .value {
            color: #6c757d;
            font-weight: 500;
            text-align: right;
            flex-grow: 1;
        }
        .value .badge {
            background: linear-gradient(135deg, #28a745, #218838);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            text-transform: capitalize;
        }

        /* Formulario de contraseña mejorado */
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-top: 30px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .password-form .form-group {
            margin-bottom: 18px;
        }
        .password-form .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .password-form .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        .password-form .form-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.1);
        }
        .password-form button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        .password-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="wrapper">
<div class="top_navbar">
      <div class="hamburger">
        <div class="one"></div>
        <div class="two"></div>
        <div class="three"></div>
      </div>
      <div class="top_menu">
        <div class="student-selector">
          <span class="logo">Estudiante:</span>
          <select id="estudiante-selector">
            <!-- Options will be populated dynamically -->
          </select>
        </div>
        <img src="../../img/FC.png" alt="gimsaber logo" width="50" height="50">
        <div class="saldo-container">
          <span id="saldo-texto">Saldo:</span>
          <span id="saldo-usuario"></span>
        </div> 
        <div class="logo">
          <img width="140" height="140" src="../../img/Logo Largo.png" alt="Logo-Colegio">
        </div>
        <ul>
          <li><a href="Cuenta.html">
              <i class="fas fa-user" title="Tu cuenta"></i>
            </a></li>
          <li><a href="../../logout.html">
              <i class="fas fa-arrow-right" title="Cerrar Sesion"></i>
            </a></li>
        </ul>
      </div>
    </div>
        <div class="sidebar">
             <ul>
                <li><a href="../../Padres.html"><span class="icon"><i class="fas fa-home"></i></span><span class="title">Inicio</span></a></li>
                <li><a href="Alimentacion.html"><span class="icon"><i class="fas fa-carrot"></i></span><span class="title">Mi alimentacion</span></a></li>
                <li><a href="Recarga.html"><span class="icon"><i class="fas fa-dollar-sign"></i></span><span class="title">Recarga</span></a></li>
                <li><a href="Comidas.html"><span class="icon"><i class="fas fa-hamburger"></i></span><span class="title">Comidas</span></a></li>
                <li><a href="Controlp.html"><span class="icon"><i class="fas fa-users-cog"></i></span><span class="title">Parental</span></a></li>
                <li><a href="pedido.html"><span class="icon"><i class="fas fa-utensils"></i></span><span class="title">Pedidos</span></a></li>
                <li><a href="ayuda.html"><span class="icon"><i class="fas fa-headset"></i></span><span class="title">Ayuda</span></a></li>
            </ul>
        </div>


        <div class="main_container">

            
            <div class="account-container">
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="avatar" id="parent-avatar">...</div>
                        <div class="user-info">
                            <h3 id="parent-name">Cargando...</h3>
                            <p id="parent-email">Cargando...</p>
                        </div>
                    </div>
                    <ul class="details-list">
                        <li><span class="label"><i class="fas fa-id-card"></i>ID de Usuario</span> <span class="value" id="parent-id">...</span></li>
                        <li><span class="label"><i class="fas fa-user-shield"></i>Rol</span> <span class="value"><span class="badge" id="parent-role">...</span></span></li>
                    </ul>

                    <h3 class="section-title">Seguridad</h3>
                    <form id="password-form" class="password-form">
                        <div class="form-group">
                            <label for="current-password">Contraseña Actual</label>
                            <input type="password" id="current-password" required>
                        </div>
                        <div class="form-group">
                            <label for="new-password">Nueva Contraseña</label>
                            <input type="password" id="new-password" required>
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">Confirmar Nueva Contraseña</label>
                            <input type="password" id="confirm-password" required>
                        </div>
                        <button type="submit">Actualizar Contraseña</button>
                    </form>
                </div>

                <div class="profile-card">
                    <div class="profile-header">
                        <div class="avatar" id="student-avatar">...</div>
                        <div class="user-info">
                            <h3 id="student-name">Seleccione un estudiante</h3>
                            <p>Datos del estudiante seleccionado</p>
                        </div>
                    </div>
                    <ul class="details-list" id="student-details-list">
                        <li><span class="label"><i class="fas fa-id-badge"></i>ID Estudiantil</span> <span class="value" id="student-id">...</span></li>
                        <li><span class="label"><i class="fas fa-graduation-cap"></i>Grado</span> <span class="value" id="student-grade">...</span></li>
                        <li><span class="label"><i class="fas fa-wallet"></i>Saldo Actual</span> <span class="value" id="student-balance">...</span></li>
                        <li><span class="label"><i class="fas fa-notes-medical"></i>Alergias / Notas</span> <span class="value" id="student-allergies">...</span></li>
                    </ul>
                </div>
            </div>

        </div>
    </div>

    <script>
                  // Lógica del Menú Lateral
            const sidebarToggle = document.getElementById('sidebar-toggle');
            if(sidebarToggle) {
                sidebarToggle.addEventListener('click', () => {
                    document.querySelector('.wrapper').classList.toggle('collapse');
                });
            }
        // --- EL JAVASCRIPT SIGUE SIENDO EXACTAMENTE EL MISMO ---
        // Pega aquí el script funcional que te proporcioné en la respuesta anterior.
        // No necesita ningún cambio para que este nuevo diseño funcione.
        document.addEventListener('DOMContentLoaded', function() {
            const apiURL = "https://web-production-b7e6.up.railway.app";

            function obtenerTokenDeLocalStorage() { return localStorage.getItem("jwtToken"); }
            function obtenerUsuarioDeLocalStorage() {
                try { return JSON.parse(localStorage.getItem("usuario")); } catch (e) { return null; }
            }
            async function hacerPeticionAutenticada(url, options = {}) {
                const token = obtenerTokenDeLocalStorage();
                if (!token) { window.location.href = "../../login.html"; throw new Error("No autenticado"); }
                const headers = { Authorization: `Bearer ${token}`, "Content-Type": "application/json", ...options.headers };
                const response = await fetch(url, { ...options, headers });
                if (response.status === 401 || response.status === 403) { window.location.href = "../../login.html"; throw new Error("Sesión expirada"); }
                return response;
            }
            function formatearSaldo(saldo) { return (parseFloat(saldo) || 0).toLocaleString("es-CO", { style: "currency", currency: "COP", minimumFractionDigits: 0, maximumFractionDigits: 0 }); }
            
            const selectorEstudiante = document.getElementById("estudiante-selector");
            const saldoElemento = document.getElementById("saldo-usuario");

            function cargarDatosPadre() {
                const usuario = obtenerUsuarioDeLocalStorage();
                if (!usuario) return;

                document.getElementById('parent-name').textContent = usuario.nombre || 'Nombre no disponible';
                document.getElementById('parent-email').textContent = usuario.usuario || 'Email no disponible';
                document.getElementById('parent-id').textContent = usuario.id || 'N/A';
                document.getElementById('parent-role').textContent = usuario.rol || 'N/A';
                
                const iniciales = usuario.nombre ? usuario.nombre.split(' ').map(n => n[0]).join('').toUpperCase() : '?';
                document.getElementById('parent-avatar').textContent = iniciales.substring(0, 2);
            }
            
            function mostrarDatosEstudiante(opcion) {
                if (!opcion || !opcion.value) {
                    document.getElementById('student-name').textContent = 'Seleccione un estudiante';
                    document.getElementById('student-id').textContent = '...';
                    document.getElementById('student-grade').textContent = '...';
                    document.getElementById('student-balance').textContent = '...';
                    document.getElementById('student-allergies').textContent = '...';
                    document.getElementById('student-avatar').textContent = '...';
                    return;
                }
                
                const nombre = opcion.textContent;
                const saldo = opcion.getAttribute('data-saldo');
                
                document.getElementById('student-name').textContent = nombre;
                document.getElementById('student-id').textContent = opcion.value;
                document.getElementById('student-balance').textContent = formatearSaldo(saldo);

                const inicialesEstudiante = nombre ? nombre.split(' ').map(n => n[0]).join('').toUpperCase() : '?';
                document.getElementById('student-avatar').textContent = inicialesEstudiante.substring(0, 2);
                
                document.getElementById('student-grade').textContent = '10º Grado';
                document.getElementById('student-allergies').textContent = 'Ninguna registrada';
            }

            async function cargarHijosYActualizarPanel() {
                const usuario = obtenerUsuarioDeLocalStorage();
                if (!usuario) return;

                try {
                    const response = await hacerPeticionAutenticada(`${apiURL}/estudiantes/${encodeURIComponent(usuario.nombre)}/hijos`);
                    if (!response.ok) throw new Error("No se pudieron cargar los hijos.");
                    
                    const hijos = await response.json();
                    selectorEstudiante.innerHTML = "";

                    if (hijos && hijos.length > 0) {
                        hijos.forEach(hijo => {
                            const option = document.createElement("option");
                            option.value = hijo.id;
                            option.setAttribute("data-saldo", hijo.saldo || 0);
                            option.textContent = hijo.nombre;
                            selectorEstudiante.appendChild(option);
                        });
                        actualizarPanelConEstudianteSeleccionado();
                    } else {
                        selectorEstudiante.innerHTML = "<option value=''>No hay hijos</option>";
                        saldoElemento.textContent = formatearSaldo(0);
                        mostrarDatosEstudiante(null);
                    }
                } catch (error) {
                    console.error("Error al cargar hijos:", error);
                }
            }
            
            function actualizarPanelConEstudianteSeleccionado() {
                const opt = selectorEstudiante.options[selectorEstudiante.selectedIndex];
                if (opt && opt.value) {
                    const saldo = opt.getAttribute("data-saldo");
                    saldoElemento.textContent = formatearSaldo(saldo);
                    mostrarDatosEstudiante(opt);
                } else {
                     saldoElemento.textContent = formatearSaldo(0);
                     mostrarDatosEstudiante(null);
                }
            }
            
            selectorEstudiante.addEventListener("change", actualizarPanelConEstudianteSeleccionado);
            
            document.getElementById('password-form').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Funcionalidad de cambio de contraseña no implementada.');
                document.getElementById('password-form').reset();
            });

            function init() {
                cargarDatosPadre();
                cargarHijosYActualizarPanel();
            }

            init();
        });
    </script>
    <script src="../../js/fuentes.js"></script>

</body>
</html>